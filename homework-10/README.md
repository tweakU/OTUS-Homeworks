## Домашнее задание № 10 — «Bash»

Цель домашнего задания: написать скрипт на языке Bash в операционной системе (ОС) GNU/Linux.

Написать скрипт для CRON, который раз в час будет формировать письмо и отправлять на заданную почту.  

Необходимая информация в письме:  
1 Список IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;  
2 Список запрашиваемых URL (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта;  
3 Ошибки веб-сервера/приложения c момента последнего запуска;  
4 Список всех кодов HTTP ответа с указанием их кол-ва с момента последнего запуска скрипта.  
5 Скрипт должен предотвращать одновременный запуск нескольких копий, до его завершения.  
В письме должен быть прописан обрабатываемый временной диапазон.


Выполнение домашнего задания:

п.1 Парсим access.log (п.2, 3 и 4 выполняются аналогично п.1):  
awk извлекает список IP адресов  
sort сортирует полученный список  
uniq -c отображает повторяющиеся строки, ключ -c добавляет информацию о количестве повторений  
sort -n сортирует строки по числовому значению  
tail без ключей выводит 10 строк с конца 
```console
awk '{ print $1}' "./access-4560-644067.log" | sort | uniq -c | sort -n | tail
```

п.5 лочим скрипт с помощью flock:
```console
#!/bin/bash

# Файл блокировки
LOCK_FILE="./hw10.lock"

# Захват блокировки
exec 200>"$LOCK_FILE"
flock -n 200 || {
  echo "Script already running. Exiting..."
  exit 1
}

# Начало выполнения скрипта
echo "Script started at: $(date)"

# Парсим лог
awk '{ print $1 }' "./access-4560-644067.log" | sort | uniq -c | sort -n | tail

# Пауза (10 секунд)
sleep 10

# Завершение скрипта
echo "Script ended at: $(date)"
```
